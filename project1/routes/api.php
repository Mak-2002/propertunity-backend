<?php

use App\Http\Controllers\{
    AdminController,
    AuthController,
    PayingController,
    PropertiesController,
    PropertyImagesController,
    UserController
};
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Route;

/*
| Changes made by Qusai 1/7/23
| 1. Added routes that requires a user to be signed in to auth middleware
| 2. Replaced properties CRUD routes with resource method
| 3. Named routes to better refrence them in code
| 4. Added routes for property images - still not done yet
*/

/*
| routes generated by resource method:
|    GET /posts - posts.index
|    GET /posts/create - posts.create
|    POST /posts - posts.store
|    GET /posts/{post} - posts.show
|    GET /posts/{post}/edit - posts.edit
|    PUT/PATCH /posts/{post} - posts.update
|    DELETE /posts/{post} - posts.destroy
*/


Route::middleware(['auth:sanctum'])->group(function () {
    Route::resource('posts', PropertiesController::class);
    Route::resource('properties/{property}/images', PropertyImagesController::class);
    Route::get('myposts', [PropertiesController::class, 'my_posts_index'])->name('my_posts');
    Route::get('favorites', [PropertiesController::class, 'favorites'])->name('properties.favorites');
    Route::post('posts/{post}/favorite', [PropertiesController::class, 'change_favorite_state'])->where('post', '[0-9]+')->name('properties.favorite');
    Route::post('/logout', [AuthController::class, 'logout']);
    Route::post('/pay/{post}', [PayingController::class, 'pay']);
    Route::prefix('/profile')->group(function() {
        Route::get('/', [UserController::class, 'my_profile']);
        Route::put('/edit', [UserController::class, 'edit_profile']);
        Route::post('/uploadphoto', [UserController::class, 'upload_profile_photo']);
    });
    Route::get('getpendingposts', [AdminController::class, 'getPendingPosts'])->name('getPendingPosts');
    Route::put('approverequest/{viewRequest}', [AdminController::class, 'approveRequest'])->name('approveRequest');
    Route::put('rejectrequest/{viewRequest}', [AdminController::class, 'rejectRequest'])->name('rejectRequest');



});

Route::post('/register', [AuthController::class, 'register'])->name('register');
Route::post('/login', [AuthController::class, 'login'])->name('login');
Route::post('/adminlogin', [AuthController::class, 'adminLogin'])->name('adminLogin');
Route::post('verification', [AuthController::class, 'verification'])->name('verification');


// Route::get('sendSMS', [AuthController::class , 'sendSMS']);
// Route::get('generateOtp', [AuthController::class , 'generateOtp']);
// Route::get('test', [PropertiesController::class , 'test']);
// Route::get('test2', [PropertiesController::class , 'test2']);

/* TODO:
add images table to user
add balance attribute to user
*/
